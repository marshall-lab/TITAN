
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Documentation for the TITAN model" name="description"/>
<link href="http://marshall-lab.github.io/TITAN/api/model/" rel="canonical"/>
<link href="../../assets/images/favicon.png" rel="shortcut icon"/>
<meta content="mkdocs-1.1.2, mkdocs-material-6.1.0" name="generator"/>
<title>Model - TITAN</title>
<link href="../../assets/stylesheets/main.bc7e593a.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.ab28b872.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&amp;display=fallback" rel="stylesheet"/>
<style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
</head>
<body data-md-color-accent="none" data-md-color-primary="none" data-md-color-scheme="" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#hivmodel">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header-nav md-grid">
<a aria-label="TITAN" class="md-header-nav__button md-logo" href="http://marshall-lab.github.io/TITAN" title="TITAN">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"></path></svg>
</a>
<label class="md-header-nav__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"></path></svg>
</label>
<div class="md-header-nav__title" data-md-component="header-title">
<div class="md-header-nav__ellipsis">
<span class="md-header-nav__topic md-ellipsis">
            TITAN
          </span>
<span class="md-header-nav__topic md-ellipsis">
            
              Model
            
          </span>
</div>
</div>
<label class="md-header-nav__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" data-md-state="active" name="query" placeholder="Search" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</label>
<button aria-label="Clear" class="md-search__icon md-icon" data-md-component="search-reset" tabindex="-1" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg>
</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="TITAN" class="md-nav__button md-logo" href="http://marshall-lab.github.io/TITAN" title="TITAN">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"></path></svg>
</a>
    TITAN
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
      Overview
    </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" id="nav-2" type="checkbox"/>
<label class="md-nav__link" for="nav-2">
      Getting Started
      <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Getting Started" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="nav-2">
<span class="md-nav__icon md-icon"></span>
        Getting Started
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../getting_started/">
      Installation
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../run_local/">
      Running locally
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../run_oscar/">
      Running on Oscar
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../contributing/">
      Contributing
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="nav-3" id="nav-3" type="checkbox"/>
<label class="md-nav__link" for="nav-3">
      API Reference
      <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="API Reference" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="nav-3">
<span class="md-nav__icon md-icon"></span>
        API Reference
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../agent/">
      Agent
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../agent_set/">
      AgentSet
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../location/">
      Location
    </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
        Model
        <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
      Model
    </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#hivmodel">
    HIVModel
  </a>
<nav aria-label="HIVModel" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.advance_vaccine">
    advance_vaccine()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.agents_interact">
    agents_interact()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.become_high_risk">
    become_high_risk()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.diagnose_hiv">
    diagnose_hiv()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.die_and_replace">
    die_and_replace()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.discontinue_prep">
    discontinue_prep()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.get_transmission_probability">
    get_transmission_probability()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.hiv_convert">
    hiv_convert()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.incarcerate">
    incarcerate()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.initialize_random_trial">
    initialize_random_trial()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.initiate_prep">
    initiate_prep()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.injection_transmission">
    injection_transmission()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.make_agent_zero">
    make_agent_zero()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.pca_interaction">
    pca_interaction()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.print_stats">
    print_stats()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.progress_to_aids">
    progress_to_aids()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.run">
    run()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.sex_transmission">
    sex_transmission()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.step">
    step()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.timeline_scaling">
    timeline_scaling()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.update_all_agents">
    update_all_agents()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.update_haart">
    update_haart()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.update_high_risk">
    update_high_risk()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.update_syringe_services">
    update_syringe_services()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../network/">
      NetworkGraphUtils
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../population/">
      Population
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../relationship/">
      Relationship
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../reporting/">
      Reporting
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../utilities/">
      Utility Functions
    </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#hivmodel">
    HIVModel
  </a>
<nav aria-label="HIVModel" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.advance_vaccine">
    advance_vaccine()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.agents_interact">
    agents_interact()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.become_high_risk">
    become_high_risk()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.diagnose_hiv">
    diagnose_hiv()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.die_and_replace">
    die_and_replace()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.discontinue_prep">
    discontinue_prep()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.get_transmission_probability">
    get_transmission_probability()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.hiv_convert">
    hiv_convert()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.incarcerate">
    incarcerate()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.initialize_random_trial">
    initialize_random_trial()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.initiate_prep">
    initiate_prep()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.injection_transmission">
    injection_transmission()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.make_agent_zero">
    make_agent_zero()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.pca_interaction">
    pca_interaction()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.print_stats">
    print_stats()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.progress_to_aids">
    progress_to_aids()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.run">
    run()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.sex_transmission">
    sex_transmission()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.step">
    step()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.timeline_scaling">
    timeline_scaling()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.update_all_agents">
    update_all_agents()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.update_haart">
    update_haart()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.update_high_risk">
    update_high_risk()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#titan.model.HIVModel.update_syringe_services">
    update_syringe_services()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<h1>Model</h1>
<h2 id="hivmodel">HIVModel</h2>
<p>The <code>HIVModel</code> class is used to model agent interactions as they progress through time.  The model can be run on an existing <code>Population</code> or it can create a <code>Population</code> during its construction.  The most common entry point to the model is <code>run</code>, which will run the model for all time steps.  To run step by step, <code>step</code> can be iterated through instead, just be sure to <code>reset_trackers</code> between <code>step</code>s.</p>
<div class="doc doc-object doc-class">
<div class="doc doc-contents first">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="titan.model.HIVModel.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">population</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
</h3>
<div class="doc doc-contents">
<p>This is the core class used to simulate
    the spread of HIV and drug use in one geography.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>params</code></td>
<td><code>ObjMap</code></td>
<td>
<p>the parameter object for this model</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>population</code></td>
<td><code>Optional[titan.population.Population]</code></td>
<td>
<p>an initialized population to run the model on</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>titan/model.py</code></summary>
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">params</span><span class="p">:</span> <span class="n">ObjMap</span><span class="p">,</span>
    <span class="n">population</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Population</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    This is the core class used to simulate</span>
<span class="sd">        the spread of HIV and drug use in one geography.</span>

<span class="sd">    args:</span>
<span class="sd">        params: the parameter object for this model</span>
<span class="sd">        population: an initialized population to run the model on</span>
<span class="sd">    """</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">params</span>
    <span class="c1"># pre-fetch commonly used param sub-sets for performance</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">features</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">calibration</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">calibration</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">"=== Begin Initialization Protocol ===</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">population</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\t</span><span class="s2">Generating new population"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop</span> <span class="o">=</span> <span class="n">Population</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\t</span><span class="s2">Using provided population"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop</span> <span class="o">=</span> <span class="n">population</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">network_utils</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NetworkGraphUtils</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">enable</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">network_utils</span> <span class="o">=</span> <span class="n">NetworkGraphUtils</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">network_utils</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n\t</span><span class="s2">Creating lists"</span><span class="p">)</span>
    <span class="c1"># Other lists / dictionaries</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">new_infections</span> <span class="o">=</span> <span class="n">AgentSet</span><span class="p">(</span><span class="s2">"new_infections"</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">new_dx</span> <span class="o">=</span> <span class="n">AgentSet</span><span class="p">(</span><span class="s2">"new_dx"</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">new_incar_release</span> <span class="o">=</span> <span class="n">AgentSet</span><span class="p">(</span><span class="s2">"new_incar_release"</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">new_high_risk</span> <span class="o">=</span> <span class="n">AgentSet</span><span class="p">(</span><span class="s2">"new_high_risk"</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">new_prep</span> <span class="o">=</span> <span class="n">AgentSet</span><span class="p">(</span><span class="s2">"new_prep"</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">ssp_enrolled_risk</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">burn_steps</span>  <span class="c1"># burn is negative time</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">nanoid</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

    <span class="c1"># Set seed format. 0: pure random, else: fixed value</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">run_seed</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_check_rand_int</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">run</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\t</span><span class="s2">Run seed was set to: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">run_seed</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">Random</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">run_seed</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">np_random</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">run_seed</span><span class="p">)</span>
    <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">run_seed</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">((</span><span class="s2">"</span><span class="se">\t</span><span class="s2">FIRST RANDOM CALL </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">))))</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\t</span><span class="s2">Resetting death count"</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">deaths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Agent</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Number of death</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2"> === Initialization Protocol Finished ==="</span><span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="titan.model.HIVModel.advance_vaccine">
<code class="highlight language-python">
advance_vaccine<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">)</span> </code>
</h3>
<div class="doc doc-contents">
<p>Progress vaccine. Agents may receive injection or progress in time
    since injection.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>agent</code></td>
<td><code>Agent</code></td>
<td>
<p>agent being updated</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>titan/model.py</code></summary>
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">advance_vaccine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span> <span class="n">Agent</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Progress vaccine. Agents may receive injection or progress in time</span>
<span class="sd">        since injection.</span>

<span class="sd">    args:</span>
<span class="sd">        agent: agent being updated</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">vaccine</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">vaccine_params</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">demographics</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">race</span><span class="p">][</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">sex_type</span>
    <span class="p">]</span><span class="o">.</span><span class="n">vaccine</span>

    <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">vaccine</span><span class="p">:</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">vaccine_time</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">vaccine</span><span class="o">.</span><span class="n">booster</span>
            <span class="ow">and</span> <span class="n">agent</span><span class="o">.</span><span class="n">vaccine_time</span> <span class="o">==</span> <span class="n">vaccine_params</span><span class="o">.</span><span class="n">booster</span><span class="o">.</span><span class="n">interval</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">vaccine_params</span><span class="o">.</span><span class="n">booster</span><span class="o">.</span><span class="n">prob</span>
        <span class="p">):</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">vaccinate</span><span class="p">()</span>

    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">==</span> <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">vaccine</span><span class="o">.</span><span class="n">start_time</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">vaccine_params</span><span class="o">.</span><span class="n">prob</span><span class="p">:</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">vaccinate</span><span class="p">()</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="titan.model.HIVModel.agents_interact">
<code class="highlight language-python">
agents_interact<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rel</span><span class="p">)</span> </code>
</h3>
<div class="doc doc-contents">
<p>Let an agent interact with a partner.</p>
<p>Based on the interaction types of the relationship, interact in the following ways:</p>
<ul>
<li>Peer Change Agent</li>
<li>Injection</li>
<li>Sex</li>
</ul>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>rel</code></td>
<td><code>Relationship</code></td>
<td>
<p>The relationship that the agents interact in</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>bool</code></td>
<td>
<p>whether the agents interacted</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>titan/model.py</code></summary>
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">agents_interact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rel</span><span class="p">:</span> <span class="n">Relationship</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    Let an agent interact with a partner.</span>

<span class="sd">    Based on the interaction types of the relationship, interact in the following ways:</span>

<span class="sd">    * Peer Change Agent</span>
<span class="sd">    * Injection</span>
<span class="sd">    * Sex</span>

<span class="sd">    args:</span>
<span class="sd">        rel : The relationship that the agents interact in</span>

<span class="sd">    returns:</span>
<span class="sd">        whether the agents interacted</span>
<span class="sd">    """</span>
    <span class="n">interaction_types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">bond_types</span><span class="p">[</span><span class="n">rel</span><span class="o">.</span><span class="n">bond_type</span><span class="p">]</span><span class="o">.</span><span class="n">acts_allowed</span>
    <span class="c1"># If either agent is incarcerated, skip their interaction</span>
    <span class="k">if</span> <span class="n">rel</span><span class="o">.</span><span class="n">agent1</span><span class="o">.</span><span class="n">incar</span> <span class="ow">or</span> <span class="n">rel</span><span class="o">.</span><span class="n">agent2</span><span class="o">.</span><span class="n">incar</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># Agent 1 is HIV+, Agent 2 is not, Agent 2 is succept</span>
    <span class="k">if</span> <span class="n">rel</span><span class="o">.</span><span class="n">agent1</span><span class="o">.</span><span class="n">hiv</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">rel</span><span class="o">.</span><span class="n">agent2</span><span class="o">.</span><span class="n">hiv</span><span class="p">:</span>
        <span class="n">agent</span> <span class="o">=</span> <span class="n">rel</span><span class="o">.</span><span class="n">agent1</span>
        <span class="n">partner</span> <span class="o">=</span> <span class="n">rel</span><span class="o">.</span><span class="n">agent2</span>
    <span class="c1"># If Agent 2 is HIV and Agent 1 is not, Agent 1 is succept</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">rel</span><span class="o">.</span><span class="n">agent1</span><span class="o">.</span><span class="n">hiv</span> <span class="ow">and</span> <span class="n">rel</span><span class="o">.</span><span class="n">agent2</span><span class="o">.</span><span class="n">hiv</span><span class="p">:</span>
        <span class="n">agent</span> <span class="o">=</span> <span class="n">rel</span><span class="o">.</span><span class="n">agent2</span>
        <span class="n">partner</span> <span class="o">=</span> <span class="n">rel</span><span class="o">.</span><span class="n">agent1</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># neither agent is HIV or both are</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">pca</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">pca</span><span class="o">.</span><span class="n">start_time</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">"pca"</span> <span class="ow">in</span> <span class="n">interaction_types</span> <span class="ow">and</span> <span class="n">rel</span><span class="o">.</span><span class="n">duration</span> <span class="o">&lt;</span> <span class="n">rel</span><span class="o">.</span><span class="n">total_duration</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pca_interaction</span><span class="p">(</span><span class="n">rel</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">hiv</span><span class="o">.</span><span class="n">start_time</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">"injection"</span> <span class="ow">in</span> <span class="n">interaction_types</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">injection_transmission</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="n">partner</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">"sex"</span> <span class="ow">in</span> <span class="n">interaction_types</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sex_transmission</span><span class="p">(</span><span class="n">rel</span><span class="p">)</span>

    <span class="k">return</span> <span class="kc">True</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="titan.model.HIVModel.become_high_risk">
<code class="highlight language-python">
become_high_risk<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
</h3>
<div class="doc doc-contents">
<p>Mark an agent as high risk and assign a duration to their high risk period</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>agent</code></td>
<td><code>Agent</code></td>
<td>
<p>agent becoming high risk</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>duration</code></td>
<td><code>int</code></td>
<td>
<p>duration of the high risk period, defaults to param value if not passed [params.high_risk.sex_based]</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>titan/model.py</code></summary>
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">become_high_risk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span> <span class="n">Agent</span><span class="p">,</span> <span class="n">duration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Mark an agent as high risk and assign a duration to their high risk period</span>

<span class="sd">    args:</span>
<span class="sd">        agent: agent becoming high risk</span>
<span class="sd">        duration: duration of the high risk period, defaults to param value if not passed [params.high_risk.sex_based]</span>
<span class="sd">    """</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">high_risk</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">agent</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">high_risk_agents</span><span class="o">.</span><span class="n">members</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">high_risk_agents</span><span class="o">.</span><span class="n">add_agent</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">agent</span><span class="o">.</span><span class="n">high_risk_ever</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_high_risk</span><span class="o">.</span><span class="n">add_agent</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>

    <span class="n">agent</span><span class="o">.</span><span class="n">high_risk</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">agent</span><span class="o">.</span><span class="n">high_risk_ever</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">duration</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">high_risk_time</span> <span class="o">=</span> <span class="n">duration</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">high_risk_time</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">high_risk</span><span class="o">.</span><span class="n">sex_based</span><span class="p">[</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">sex_type</span>
        <span class="p">]</span><span class="o">.</span><span class="n">duration</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="titan.model.HIVModel.diagnose_hiv">
<code class="highlight language-python">
diagnose_hiv<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">)</span> </code>
</h3>
<div class="doc doc-contents">
<p>Stochastically test the agent for HIV. If tested, mark the agent as diagnosed and trace their partners (if partner tracing enabled).</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>agent</code></td>
<td><code>Agent</code></td>
<td>
<p>HIV positive agent to diagnose</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>titan/model.py</code></summary>
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">diagnose_hiv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span> <span class="n">Agent</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Stochastically test the agent for HIV. If tested, mark the agent as diagnosed and trace their partners (if partner tracing enabled).</span>

<span class="sd">    args:</span>
<span class="sd">        agent: HIV positive agent to diagnose</span>
<span class="sd">    """</span>
    <span class="n">sex_type</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">sex_type</span>
    <span class="n">race_type</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">race</span>
    <span class="n">diagnosed</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">hiv_dx</span>
    <span class="n">partner_tracing</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">partner_tracing</span>

    <span class="k">def</span> <span class="nf">diagnose</span><span class="p">(</span>
        <span class="n">agent</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="c1"># agent's location's params used throughout as that is the agent who</span>
        <span class="c1"># would be interacting with the service</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">hiv_dx</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">dx_counts</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">race</span><span class="p">][</span><span class="n">agent</span><span class="o">.</span><span class="n">sex_type</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_dx</span><span class="o">.</span><span class="n">add_agent</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">partner_tracing</span>
            <span class="ow">and</span> <span class="n">partner_tracing</span><span class="o">.</span><span class="n">start_time</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&lt;</span> <span class="n">partner_tracing</span><span class="o">.</span><span class="n">stop_time</span>
        <span class="p">):</span>
            <span class="c1"># Determine if each partner is found via partner tracing</span>
            <span class="k">for</span> <span class="n">ptnr</span> <span class="ow">in</span> <span class="n">agent</span><span class="o">.</span><span class="n">get_partners</span><span class="p">(</span><span class="n">partner_tracing</span><span class="o">.</span><span class="n">bond_type</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="ow">not</span> <span class="n">ptnr</span><span class="o">.</span><span class="n">hiv_dx</span>
                    <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">partner_tracing</span><span class="o">.</span><span class="n">prob</span>
                <span class="p">):</span>
                    <span class="n">ptnr</span><span class="o">.</span><span class="n">partner_traced</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">ptnr</span><span class="o">.</span><span class="n">trace_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">diagnosed</span><span class="p">:</span>
        <span class="n">test_prob</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">demographics</span><span class="p">[</span><span class="n">race_type</span><span class="p">][</span>
            <span class="n">sex_type</span>
        <span class="p">]</span><span class="o">.</span><span class="n">hiv</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">prob</span>

        <span class="c1"># Rescale based on calibration param</span>
        <span class="n">test_prob</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibration</span><span class="o">.</span><span class="n">test_frequency</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">test_prob</span><span class="p">:</span>
            <span class="n">diagnose</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">partner_traced</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">partner_tracing</span><span class="o">.</span><span class="n">hiv</span><span class="o">.</span><span class="n">dx</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&gt;</span> <span class="n">agent</span><span class="o">.</span><span class="n">trace_time</span>
        <span class="p">):</span>
            <span class="n">diagnose</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&gt;=</span> <span class="n">agent</span><span class="o">.</span><span class="n">trace_time</span> <span class="o">+</span> <span class="n">partner_tracing</span><span class="o">.</span><span class="n">trace_duration</span><span class="p">:</span>
        <span class="c1"># agents can only be traced during a specified period after their partner is</span>
        <span class="c1"># diagnosed. If past this time, remove ability to trace.</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">partner_traced</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="titan.model.HIVModel.die_and_replace">
<code class="highlight language-python">
die_and_replace<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
</h3>
<div class="doc doc-contents">
<p>Let agents die and replace the dead agent with a new agent randomly.</p>
<details class="quote">
<summary>Source code in <code>titan/model.py</code></summary>
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">die_and_replace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

    <span class="sd">"""</span>
<span class="sd">    Let agents die and replace the dead agent with a new agent randomly.</span>
<span class="sd">    """</span>
    <span class="c1"># die stage</span>
    <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">all_agents</span><span class="p">:</span>

        <span class="c1"># agent incarcerated, don't evaluate for death</span>
        <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">incar</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="c1"># death rate per 1 person-month</span>
        <span class="n">p</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">prob</span><span class="o">.</span><span class="n">get_death_rate</span><span class="p">(</span>
                <span class="n">agent</span><span class="o">.</span><span class="n">hiv</span><span class="p">,</span>
                <span class="n">agent</span><span class="o">.</span><span class="n">aids</span><span class="p">,</span>
                <span class="n">agent</span><span class="o">.</span><span class="n">drug_type</span><span class="p">,</span>
                <span class="n">agent</span><span class="o">.</span><span class="n">haart_adherence</span><span class="p">,</span>
                <span class="n">agent</span><span class="o">.</span><span class="n">race</span><span class="p">,</span>
                <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">steps_per_year</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibration</span><span class="o">.</span><span class="n">mortality</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">deaths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>

            <span class="c1"># End all existing relationships</span>
            <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">copy</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">relationships</span><span class="p">):</span>
                <span class="n">rel</span><span class="o">.</span><span class="n">progress</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">remove_relationship</span><span class="p">(</span><span class="n">rel</span><span class="p">)</span>

    <span class="c1"># replace stage</span>
    <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">deaths</span><span class="p">:</span>
        <span class="c1"># Remove agent from agent class and sub-sets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">remove_agent</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>

        <span class="n">new_agent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">create_agent</span><span class="p">(</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="n">agent</span><span class="o">.</span><span class="n">race</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">agent</span><span class="o">.</span><span class="n">sex_type</span><span class="p">,</span> <span class="n">agent</span><span class="o">.</span><span class="n">drug_type</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">add_agent</span><span class="p">(</span><span class="n">new_agent</span><span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="titan.model.HIVModel.discontinue_prep">
<code class="highlight language-python">
discontinue_prep<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> </code>
</h3>
<div class="doc doc-contents">
<p>Update agent's PrEP status and discontinue stochastically or if <code>force</code> is True</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>agent</code></td>
<td><code>Agent</code></td>
<td>
<p>agent being updated</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>force</code></td>
<td><code>bool</code></td>
<td>
<p>whether to force discontinuation of PrEP</p>
</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>titan/model.py</code></summary>
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">discontinue_prep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span> <span class="n">Agent</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Update agent's PrEP status and discontinue stochastically or if `force` is True</span>

<span class="sd">    args:</span>
<span class="sd">        agent: agent being updated</span>
<span class="sd">        force: whether to force discontinuation of PrEP</span>
<span class="sd">    """</span>
    <span class="c1"># Agent must be on PrEP to discontinue PrEP</span>
    <span class="k">assert</span> <span class="n">agent</span><span class="o">.</span><span class="n">prep</span>

    <span class="c1"># If force flag set, auto kick off prep.</span>
    <span class="k">if</span> <span class="n">force</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">prep_counts</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">race</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">prep</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">prep_load</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">prep_last_dose</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># else if agent is on PrEP, see if they should discontinue</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
        <span class="o">&lt;</span> <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">demographics</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">race</span><span class="p">][</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">sex_type</span>
        <span class="p">]</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">discontinue</span>
        <span class="ow">and</span> <span class="n">agent</span><span class="o">.</span><span class="n">prep_type</span> <span class="o">==</span> <span class="s2">"Oral"</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">prep_counts</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">race</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">prep</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">prep_type</span> <span class="o">=</span> <span class="s2">""</span>

    <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">prep_type</span> <span class="o">==</span> <span class="s2">"Inj"</span><span class="p">:</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">update_prep_load</span><span class="p">()</span>
        <span class="c1"># agent timed out of prep</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">agent</span><span class="o">.</span><span class="n">prep</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">prep_counts</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">race</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="titan.model.HIVModel.get_transmission_probability">
<code class="highlight language-python">
get_transmission_probability<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interaction</span><span class="p">,</span> <span class="n">agent</span><span class="p">,</span> <span class="n">partner</span><span class="p">)</span> </code>
</h3>
<div class="doc doc-contents">
<p>Determines the probability of a transmission event based on
    interaction type. For sex acts, transmission probability is a
    function of the acquisition probability of the HIV- agent's sex role
    and the HIV+ agent's haart adherence, acute status, and dx risk reduction</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>interaction</code></td>
<td><code>str</code></td>
<td>
<p>"injection" or "sex"</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>agent</code></td>
<td><code></code></td>
<td>
<p>HIV+ Agent</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>partner</code></td>
<td><code></code></td>
<td>
<p>HIV- Agent</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>float</code></td>
<td>
<p>probability of transmission from agent to partner</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>titan/model.py</code></summary>
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_transmission_probability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interaction</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">agent</span><span class="p">,</span> <span class="n">partner</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    Determines the probability of a transmission event based on</span>
<span class="sd">        interaction type. For sex acts, transmission probability is a</span>
<span class="sd">        function of the acquisition probability of the HIV- agent's sex role</span>
<span class="sd">        and the HIV+ agent's haart adherence, acute status, and dx risk reduction</span>

<span class="sd">    args:</span>
<span class="sd">        interaction : "injection" or "sex"</span>
<span class="sd">        agent: HIV+ Agent</span>
<span class="sd">        partner: HIV- Agent</span>

<span class="sd">    returns:</span>
<span class="sd">        probability of transmission from agent to partner</span>
<span class="sd">    """</span>
    <span class="c1"># Logic for if needle or sex type interaction</span>
    <span class="n">p</span><span class="p">:</span> <span class="nb">float</span>
    <span class="k">assert</span> <span class="n">interaction</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">"injection"</span><span class="p">,</span> <span class="s2">"sex"</span><span class="p">),</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">"Invalid interaction type </span><span class="si">{</span><span class="n">interaction</span><span class="si">}</span><span class="s2">. Only sex and injection acts "</span>
        <span class="sa">f</span><span class="s2">"supported. "</span>
    <span class="p">)</span>

    <span class="n">agent_sex_role</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">sex_role</span>
    <span class="n">partner_sex_role</span> <span class="o">=</span> <span class="n">partner</span><span class="o">.</span><span class="n">sex_role</span>

    <span class="k">if</span> <span class="n">interaction</span> <span class="o">==</span> <span class="s2">"injection"</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">partnership</span><span class="o">.</span><span class="n">injection</span><span class="o">.</span><span class="n">transmission</span><span class="o">.</span><span class="n">base</span>
        <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">haart</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">*=</span> <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">partnership</span><span class="o">.</span><span class="n">injection</span><span class="o">.</span><span class="n">transmission</span><span class="o">.</span><span class="n">haart_scaling</span><span class="p">[</span>
                <span class="n">agent</span><span class="o">.</span><span class="n">haart_adherence</span>
            <span class="p">]</span><span class="o">.</span><span class="n">scale</span>
    <span class="k">elif</span> <span class="n">interaction</span> <span class="o">==</span> <span class="s2">"sex"</span><span class="p">:</span>
        <span class="c1"># get partner's sex role during acts</span>
        <span class="k">if</span> <span class="n">partner_sex_role</span> <span class="o">==</span> <span class="s2">"versatile"</span><span class="p">:</span>  <span class="c1"># versatile partner takes</span>
            <span class="c1"># "opposite" position of agent</span>
            <span class="k">if</span> <span class="n">agent_sex_role</span> <span class="o">==</span> <span class="s2">"insertive"</span><span class="p">:</span>
                <span class="n">partner_sex_role</span> <span class="o">=</span> <span class="s2">"receptive"</span>
            <span class="k">elif</span> <span class="n">agent_sex_role</span> <span class="o">==</span> <span class="s2">"receptive"</span><span class="p">:</span>
                <span class="n">partner_sex_role</span> <span class="o">=</span> <span class="s2">"insertive"</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">partner_sex_role</span> <span class="o">=</span> <span class="s2">"versatile"</span>  <span class="c1"># if both versatile, can switch</span>
                <span class="c1"># between receptive and insertive by act</span>
        <span class="c1"># get probability of sex acquisition given HIV- partner's position</span>

        <span class="n">p</span> <span class="o">=</span> <span class="n">partner</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">partnership</span><span class="o">.</span><span class="n">sex</span><span class="o">.</span><span class="n">acquisition</span><span class="p">[</span><span class="n">partner</span><span class="o">.</span><span class="n">sex_type</span><span class="p">][</span>
            <span class="n">partner_sex_role</span>
        <span class="p">]</span>

        <span class="c1"># scale based on HIV+ agent's haart status/adherence</span>
        <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">haart</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">*=</span> <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">partnership</span><span class="o">.</span><span class="n">sex</span><span class="o">.</span><span class="n">haart_scaling</span><span class="p">[</span>
                <span class="n">agent</span><span class="o">.</span><span class="n">sex_type</span>
            <span class="p">][</span><span class="n">agent</span><span class="o">.</span><span class="n">haart_adherence</span><span class="p">]</span><span class="o">.</span><span class="n">prob</span>

    <span class="c1"># Scale if partner on PrEP</span>
    <span class="k">if</span> <span class="n">partner</span><span class="o">.</span><span class="n">prep</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">partner</span><span class="o">.</span><span class="n">prep_type</span> <span class="o">==</span> <span class="s2">"Oral"</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">partner</span><span class="o">.</span><span class="n">prep_adherence</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">*=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">partner</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">efficacy</span><span class="o">.</span><span class="n">adherent</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">*=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">partner</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">efficacy</span><span class="o">.</span><span class="n">non_adherant</span>
        <span class="k">elif</span> <span class="n">partner</span><span class="o">.</span><span class="n">prep_type</span> <span class="o">==</span> <span class="s2">"Inj"</span> <span class="ow">and</span> <span class="n">partner</span><span class="o">.</span><span class="n">prep_adherence</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">*=</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">5.528636721</span> <span class="o">*</span> <span class="n">partner</span><span class="o">.</span><span class="n">prep_load</span><span class="p">)</span>

    <span class="c1"># Scale if partner vaccinated</span>
    <span class="k">if</span> <span class="n">partner</span><span class="o">.</span><span class="n">vaccine</span><span class="p">:</span>
        <span class="n">vaccine_type</span> <span class="o">=</span> <span class="n">partner</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">vaccine</span><span class="o">.</span><span class="n">type</span>
        <span class="n">vaccine_time_months</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">partner</span><span class="o">.</span><span class="n">vaccine_time</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">steps_per_year</span>
        <span class="p">)</span> <span class="o">*</span> <span class="mi">12</span>

        <span class="k">if</span> <span class="n">vaccine_type</span> <span class="o">==</span> <span class="s2">"HVTN702"</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.88</span> <span class="o">+</span> <span class="mf">0.76</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="n">vaccine_time_months</span> <span class="o">+</span> <span class="mf">0.001</span><span class="p">)</span> <span class="o">*</span> <span class="mi">30</span><span class="p">)))</span>
        <span class="k">elif</span> <span class="n">vaccine_type</span> <span class="o">==</span> <span class="s2">"RV144"</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.40</span> <span class="o">+</span> <span class="mf">0.76</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">vaccine_time_months</span><span class="p">)))</span>

    <span class="c1"># Scaling parameter for acute HIV infections</span>
    <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">get_acute_status</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">hiv</span><span class="o">.</span><span class="n">acute</span><span class="o">.</span><span class="n">duration</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">*=</span> <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">hiv</span><span class="o">.</span><span class="n">acute</span><span class="o">.</span><span class="n">infectivity</span>

    <span class="c1"># Scaling parameter for positively identified HIV agents</span>
    <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">hiv_dx</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">*=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">hiv</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">risk_reduction</span><span class="p">[</span><span class="n">interaction</span><span class="p">]</span>

    <span class="c1"># Tuning parameter for ART efficiency</span>
    <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">haart</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibration</span><span class="o">.</span><span class="n">haart</span><span class="o">.</span><span class="n">transmission</span>

    <span class="c1"># Racial calibration parameter to attain proper race incidence disparity</span>
    <span class="n">p</span> <span class="o">*=</span> <span class="n">partner</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">demographics</span><span class="p">[</span><span class="n">partner</span><span class="o">.</span><span class="n">race</span><span class="p">]</span><span class="o">.</span><span class="n">hiv</span><span class="o">.</span><span class="n">transmission</span>

    <span class="c1"># Scaling parameter for per act transmission.</span>
    <span class="n">p</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibration</span><span class="o">.</span><span class="n">acquisition</span>

    <span class="k">return</span> <span class="n">p</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="titan.model.HIVModel.hiv_convert">
<code class="highlight language-python">
hiv_convert<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">)</span> </code>
</h3>
<div class="doc doc-contents">
<p>Agent becomes HIV agent. Update all appropriate list and dictionaries.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>agent</code></td>
<td><code>Agent</code></td>
<td>
<p>The agent being converted</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>titan/model.py</code></summary>
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">hiv_convert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span> <span class="n">Agent</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Agent becomes HIV agent. Update all appropriate list and dictionaries.</span>

<span class="sd">    args:</span>
<span class="sd">        agent: The agent being converted</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">agent</span><span class="o">.</span><span class="n">hiv</span><span class="p">:</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">hiv</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">hiv_time</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">vaccine</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_infections</span><span class="o">.</span><span class="n">add_agent</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">hiv_agents</span><span class="o">.</span><span class="n">add_agent</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">prep</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">discontinue_prep</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="titan.model.HIVModel.incarcerate">
<code class="highlight language-python">
incarcerate<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">)</span> </code>
</h3>
<div class="doc doc-contents">
<p>Incarcerate an agent or update their incarceration variables</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>agent</code></td>
<td><code>Agent</code></td>
<td>
<p>agent being updated</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>titan/model.py</code></summary>
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">incarcerate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span> <span class="n">Agent</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Incarcerate an agent or update their incarceration variables</span>

<span class="sd">    args:</span>
<span class="sd">        agent: agent being updated</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">incar</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">hiv_bool</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">hiv</span>

    <span class="k">if</span> <span class="n">hiv_bool</span><span class="p">:</span>
        <span class="n">hiv_multiplier</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">hiv</span><span class="o">.</span><span class="n">multiplier</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">hiv_multiplier</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">incar</span><span class="p">:</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">incar_time</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">incar_time</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># FREE AGENT</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">new_incar_release</span><span class="o">.</span><span class="n">add_agent</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">incar</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="n">agent</span><span class="o">.</span><span class="n">high_risk</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">high_risk</span>
            <span class="p">):</span>  <span class="c1"># If behavioral treatment on and agent HIV, ignore HR period.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">become_high_risk</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">high_risk</span><span class="o">.</span><span class="n">partnership_types</span><span class="p">:</span>
                    <span class="n">agent</span><span class="o">.</span><span class="n">mean_num_partners</span><span class="p">[</span>
                        <span class="n">bond</span>
                    <span class="p">]</span> <span class="o">+=</span> <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">high_risk</span><span class="o">.</span><span class="n">partner_scale</span>
                    <span class="n">agent</span><span class="o">.</span><span class="n">target_partners</span><span class="p">[</span><span class="n">bond</span><span class="p">]</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span>
                        <span class="n">agent</span><span class="o">.</span><span class="n">mean_num_partners</span><span class="p">[</span><span class="n">bond</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">np_random</span>
                    <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">update_partnerability</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">hiv_bool</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">haart</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
                        <span class="o">&lt;=</span> <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">haart</span><span class="o">.</span><span class="n">discontinue</span>
                    <span class="p">):</span>  <span class="c1"># 12% remain surpressed</span>
                        <span class="n">agent</span><span class="o">.</span><span class="n">haart</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="n">agent</span><span class="o">.</span><span class="n">haart_adherence</span> <span class="o">=</span> <span class="mi">0</span>

                    <span class="c1"># END FORCE</span>

    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="p">(</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">demographics</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">race</span><span class="p">][</span><span class="n">agent</span><span class="o">.</span><span class="n">sex_type</span><span class="p">]</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">prob</span>
        <span class="o">*</span> <span class="n">hiv_multiplier</span>
        <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibration</span><span class="o">.</span><span class="n">incarceration</span>
    <span class="p">):</span>
        <span class="n">incar_duration</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">demographics</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">race</span><span class="p">][</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">sex_type</span>
        <span class="p">]</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">prob</span>

        <span class="nb">bin</span> <span class="o">=</span> <span class="n">current_p_value</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">p</span> <span class="o">&gt;=</span> <span class="n">current_p_value</span><span class="p">:</span>
            <span class="n">current_p_value</span> <span class="o">+=</span> <span class="n">incar_duration</span><span class="p">[</span><span class="nb">bin</span><span class="p">]</span><span class="o">.</span><span class="n">prob</span>
            <span class="nb">bin</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">timestay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span>
            <span class="n">incar_duration</span><span class="p">[</span><span class="nb">bin</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">incar_duration</span><span class="p">[</span><span class="nb">bin</span><span class="p">]</span><span class="o">.</span><span class="n">max</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">hiv_bool</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">agent</span><span class="o">.</span><span class="n">hiv_dx</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">hiv</span><span class="o">.</span><span class="n">dx</span><span class="p">:</span>
                    <span class="n">agent</span><span class="o">.</span><span class="n">hiv_dx</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># Then tested and HIV, check to enroll in ART</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
                    <span class="o">&lt;</span> <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">haart</span><span class="o">.</span><span class="n">prob</span>
                <span class="p">):</span>
                    <span class="n">tmp_rnd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
                    <span class="n">haart_adh</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">haart</span><span class="o">.</span><span class="n">adherence</span>
                    <span class="k">if</span> <span class="n">tmp_rnd</span> <span class="o">&lt;</span> <span class="n">haart_adh</span><span class="p">:</span>
                        <span class="n">adherence</span> <span class="o">=</span> <span class="mi">5</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">adherence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

                    <span class="c1"># Add agent to HAART class set, update agent params</span>
                    <span class="n">agent</span><span class="o">.</span><span class="n">haart</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">agent</span><span class="o">.</span><span class="n">haart_adherence</span> <span class="o">=</span> <span class="n">adherence</span>
                    <span class="n">agent</span><span class="o">.</span><span class="n">haart_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span>

        <span class="n">agent</span><span class="o">.</span><span class="n">incar</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">incar_time</span> <span class="o">=</span> <span class="n">timestay</span>

        <span class="c1"># PUT PARTNERS IN HIGH RISK</span>
        <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">high_risk</span><span class="o">.</span><span class="n">partnership_types</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">partner</span> <span class="ow">in</span> <span class="n">agent</span><span class="o">.</span><span class="n">partners</span><span class="p">[</span><span class="n">bond</span><span class="p">]:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">partner</span><span class="o">.</span><span class="n">high_risk</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">high_risk</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
                        <span class="o">&lt;</span> <span class="n">partner</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">high_risk</span><span class="o">.</span><span class="n">prob</span>
                    <span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">become_high_risk</span><span class="p">(</span><span class="n">partner</span><span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="titan.model.HIVModel.initialize_random_trial">
<code class="highlight language-python">
initialize_random_trial<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
</h3>
<div class="doc doc-contents">
<p>Initialize a random trial in the population</p>
<details class="quote">
<summary>Source code in <code>titan/model.py</code></summary>
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">initialize_random_trial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Initialize a random trial in the population</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">enable</span>
    <span class="p">),</span> <span class="s2">"Network must be enabled for random trial"</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">"Starting random trial"</span><span class="p">)</span>
    <span class="n">components</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">connected_components</span><span class="p">()</span>

    <span class="n">total_nodes</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">"Number of components"</span><span class="p">,</span>
        <span class="nb">len</span><span class="p">([</span><span class="mi">1</span> <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">components</span> <span class="k">if</span> <span class="n">comp</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()]),</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">components</span><span class="p">:</span>
        <span class="n">total_nodes</span> <span class="o">+=</span> <span class="n">comp</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
            <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">random_trial</span><span class="o">.</span><span class="n">intervention</span><span class="o">.</span><span class="n">prob</span>
        <span class="p">):</span>
            <span class="c1"># Component selected as treatment pod!</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">pca</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ag</span> <span class="ow">in</span> <span class="n">comp</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
                    <span class="n">ag</span><span class="o">.</span><span class="n">random_trial_enrolled</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">ag</span><span class="o">.</span><span class="n">hiv</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">ag</span><span class="o">.</span><span class="n">prep</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
                            <span class="o">&lt;</span> <span class="n">ag</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">target</span>
                            <span class="ow">and</span> <span class="ow">not</span> <span class="n">ag</span><span class="o">.</span><span class="n">vaccine</span>
                        <span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">initiate_prep</span><span class="p">(</span><span class="n">ag</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                            <span class="n">ag</span><span class="o">.</span><span class="n">intervention_ever</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">pca</span><span class="o">.</span><span class="n">choice</span> <span class="o">==</span> <span class="s2">"eigenvector"</span><span class="p">:</span>
                <span class="n">centrality</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">algorithms</span><span class="o">.</span><span class="n">centrality</span><span class="o">.</span><span class="n">eigenvector_centrality</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">centrality</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"Empty centrality"</span>
                <span class="n">ordered_centrality</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">centrality</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">centrality</span><span class="o">.</span><span class="n">get</span><span class="p">)</span>
                <span class="n">intervention_agent</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">for</span> <span class="n">ag</span> <span class="ow">in</span> <span class="n">ordered_centrality</span><span class="p">:</span>
                    <span class="n">ag</span><span class="o">.</span><span class="n">random_trial_enrolled</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">ag</span><span class="o">.</span><span class="n">hiv</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">intervention_agent</span><span class="p">:</span>
                        <span class="n">ag</span><span class="o">.</span><span class="n">prep_awareness</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">ag</span><span class="o">.</span><span class="n">pca</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">ag</span><span class="o">.</span><span class="n">pca_suitable</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">ag</span><span class="o">.</span><span class="n">intervention_ever</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">intervention_agent</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">intervention_agent</span><span class="p">:</span>
                    <span class="n">ag</span> <span class="o">=</span> <span class="n">ordered_centrality</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">pca</span><span class="o">.</span><span class="n">choice</span> <span class="o">==</span> <span class="s2">"bridge"</span><span class="p">:</span>
                <span class="c1"># list all edges that are bridges</span>
                <span class="k">for</span> <span class="n">ag</span> <span class="ow">in</span> <span class="n">comp</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
                    <span class="n">ag</span><span class="o">.</span><span class="n">random_trial_enrolled</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="n">all_bridges</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">bridges</span><span class="p">(</span><span class="n">comp</span><span class="p">))</span>
                <span class="n">comp_agents</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">agent</span>
                    <span class="k">for</span> <span class="n">agents</span> <span class="ow">in</span> <span class="n">all_bridges</span>
                    <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="n">agents</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">agent</span><span class="o">.</span><span class="n">hiv</span>
                <span class="p">]</span>  <span class="c1"># all suitable agents in bridges</span>

                <span class="k">if</span> <span class="n">comp_agents</span><span class="p">:</span>
                    <span class="n">chosen_agent</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">safe_random_choice</span><span class="p">(</span>
                        <span class="n">comp_agents</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span>
                    <span class="p">)</span>  <span class="c1"># select change agent</span>
                    <span class="n">chosen_agent</span><span class="o">.</span><span class="n">prep_awareness</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># make aware</span>
                    <span class="n">chosen_agent</span><span class="o">.</span><span class="n">pca</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">chosen_agent</span><span class="o">.</span><span class="n">pca_suitable</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">chosen_agent</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">comp</span><span class="o">.</span><span class="n">nodes</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">chosen_agent</span><span class="o">.</span><span class="n">pca</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">pca</span><span class="o">.</span><span class="n">choice</span> <span class="o">==</span> <span class="s2">"random"</span><span class="p">:</span>
                <span class="n">suitable_agent_choices</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">ag</span> <span class="ow">in</span> <span class="n">comp</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
                    <span class="n">ag</span><span class="o">.</span><span class="n">random_trial_enrolled</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">ag</span><span class="o">.</span><span class="n">hiv</span><span class="p">:</span>
                        <span class="n">suitable_agent_choices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ag</span><span class="p">)</span>

                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">suitable_agent_choices</span>
                <span class="p">):</span>  <span class="c1"># if there are agents who meet eligibility criteria,</span>
                    <span class="c1"># select one randomly</span>
                    <span class="n">chosen_agent</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">safe_random_choice</span><span class="p">(</span>
                        <span class="n">suitable_agent_choices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span>
                    <span class="p">)</span>
                    <span class="n">chosen_agent</span><span class="o">.</span><span class="n">pca</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">chosen_agent</span><span class="o">.</span><span class="n">pca_suitable</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">chosen_agent</span><span class="o">.</span><span class="n">prep_awareness</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># make aware</span>
                    <span class="n">chosen_agent</span><span class="o">.</span><span class="n">intervention_ever</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># if no suitable agents, mark a non-suitable agent</span>
                    <span class="n">chosen_agent</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">safe_random_choice</span><span class="p">(</span>
                        <span class="nb">list</span><span class="p">(</span><span class="n">comp</span><span class="o">.</span><span class="n">nodes</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span>
                    <span class="p">)</span>
                    <span class="n">chosen_agent</span><span class="o">.</span><span class="n">pca</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nb">print</span><span class="p">((</span><span class="s2">"Total agents in trial: "</span><span class="p">,</span> <span class="n">total_nodes</span><span class="p">))</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="titan.model.HIVModel.initiate_prep">
<code class="highlight language-python">
initiate_prep<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> </code>
</h3>
<div class="doc doc-contents">
<p>Place agents onto PrEP treatment. PrEP treatment assumes that the agent knows their HIV status is negative.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>agent</code></td>
<td><code>Agent</code></td>
<td>
<p>agent being updated</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>force</code></td>
<td><code>bool</code></td>
<td>
<p>whether to force the agent to enroll instead of using the appropriate algorithm per the prep params</p>
</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>titan/model.py</code></summary>
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">initiate_prep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span> <span class="n">Agent</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Place agents onto PrEP treatment. PrEP treatment assumes that the agent knows their HIV status is negative.</span>

<span class="sd">    args:</span>
<span class="sd">        agent : agent being updated</span>
<span class="sd">        force : whether to force the agent to enroll instead of using the appropriate algorithm per the prep params</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="nf">enroll_prep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span> <span class="n">Agent</span><span class="p">):</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">enroll_prep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">run_random</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">new_prep</span><span class="o">.</span><span class="n">add_agent</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">prep_counts</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">race</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># agent must exist</span>
    <span class="k">assert</span> <span class="n">agent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="c1"># Prep only valid for agents not on prep and are HIV negative</span>
    <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">prep</span> <span class="ow">or</span> <span class="n">agent</span><span class="o">.</span><span class="n">hiv</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="c1"># Determine probability of HIV treatment</span>
    <span class="k">if</span> <span class="n">force</span><span class="p">:</span>
        <span class="n">enroll_prep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">"Racial"</span> <span class="ow">in</span> <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">target_model</span><span class="p">:</span>
            <span class="n">num_prep_agents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">prep_counts</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">race</span><span class="p">]</span>
            <span class="n">all_hiv_agents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">hiv_agents</span><span class="o">.</span><span class="n">members</span>
            <span class="n">all_race</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">all_agents</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">race</span> <span class="o">==</span> <span class="n">agent</span><span class="o">.</span><span class="n">race</span><span class="p">}</span>

            <span class="n">hiv_agents</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_hiv_agents</span> <span class="o">&amp;</span> <span class="n">all_race</span><span class="p">)</span>
            <span class="n">target_prep</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">all_race</span><span class="p">)</span> <span class="o">-</span> <span class="n">hiv_agents</span>
            <span class="p">)</span> <span class="o">*</span> <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">demographics</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">race</span><span class="p">][</span>
                <span class="n">agent</span><span class="o">.</span><span class="n">sex_type</span>
            <span class="p">]</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">coverage</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">num_prep_agents</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">prep_counts</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="n">target_prep</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">all_agents</span><span class="o">.</span><span class="n">num_members</span><span class="p">()</span>
                    <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">hiv_agents</span><span class="o">.</span><span class="n">num_members</span><span class="p">()</span>
                <span class="p">)</span>
                <span class="o">*</span> <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">target</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="n">num_prep_agents</span> <span class="o">&lt;</span> <span class="n">target_prep</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&gt;=</span> <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">start_time</span>
            <span class="ow">and</span> <span class="n">agent</span><span class="o">.</span><span class="n">prep_eligible</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="n">enroll_prep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="titan.model.HIVModel.injection_transmission">
<code class="highlight language-python">
injection_transmission<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">,</span> <span class="n">partner</span><span class="p">)</span> </code>
</h3>
<div class="doc doc-contents">
<p>Simulate random transmission of HIV between two PWID agents through injection.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>agent</code></td>
<td><code>Agent</code></td>
<td>
<p>PWID agent with HIV</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>partner</code></td>
<td><code>Agent</code></td>
<td>
<p>PWID agent without HIV</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>titan/model.py</code></summary>
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">injection_transmission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span> <span class="n">Agent</span><span class="p">,</span> <span class="n">partner</span><span class="p">:</span> <span class="n">Agent</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Simulate random transmission of HIV between two PWID agents through injection.</span>

<span class="sd">    args:</span>
<span class="sd">        agent: PWID agent with HIV</span>
<span class="sd">        partner: PWID agent without HIV</span>
<span class="sd">    """</span>

    <span class="k">assert</span> <span class="n">agent</span><span class="o">.</span><span class="n">hiv</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">partner</span><span class="o">.</span><span class="n">hiv</span>
    <span class="k">assert</span> <span class="n">agent</span><span class="o">.</span><span class="n">drug_type</span> <span class="o">==</span> <span class="s2">"Inj"</span>
    <span class="k">assert</span> <span class="n">partner</span><span class="o">.</span><span class="n">drug_type</span> <span class="o">==</span> <span class="s2">"Inj"</span>

    <span class="n">agent_race</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">race</span>
    <span class="n">agent_sex_type</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">sex_type</span>

    <span class="n">mean_num_acts</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">demographics</span><span class="p">[</span><span class="n">agent_race</span><span class="p">][</span>
            <span class="n">agent_sex_type</span>
        <span class="p">]</span><span class="o">.</span><span class="n">injection</span><span class="o">.</span><span class="n">num_acts</span>
        <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibration</span><span class="o">.</span><span class="n">injection</span><span class="o">.</span><span class="n">act</span>
    <span class="p">)</span>
    <span class="n">share_acts</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">mean_num_acts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">np_random</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">ssp</span> <span class="ow">or</span> <span class="n">partner</span><span class="o">.</span><span class="n">ssp</span><span class="p">:</span>  <span class="c1"># syringe services program risk</span>
        <span class="n">p_unsafe_injection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ssp_enrolled_risk</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If sharing, minimum of 1 share act</span>
        <span class="k">if</span> <span class="n">share_acts</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">share_acts</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">p_unsafe_injection</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">demographics</span><span class="p">[</span><span class="n">agent_race</span><span class="p">][</span>
            <span class="n">agent_sex_type</span>
        <span class="p">]</span><span class="o">.</span><span class="n">injection</span><span class="o">.</span><span class="n">unsafe_prob</span>

        <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">hiv_dx</span> <span class="ow">or</span> <span class="n">partner</span><span class="o">.</span><span class="n">hiv_dx</span><span class="p">:</span>  <span class="c1"># diagnosis risk reduction</span>
            <span class="n">p_unsafe_injection</span> <span class="o">*=</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">hiv</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">risk_reduction</span><span class="o">.</span><span class="n">injection</span>

    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">share_acts</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">p_unsafe_injection</span><span class="p">:</span>
            <span class="n">share_acts</span> <span class="o">-=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">share_acts</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_transmission_probability</span><span class="p">(</span><span class="s2">"injection"</span><span class="p">,</span> <span class="n">agent</span><span class="p">,</span> <span class="n">partner</span><span class="p">)</span>

        <span class="n">p_total_transmission</span><span class="p">:</span> <span class="nb">float</span>
        <span class="k">if</span> <span class="n">share_acts</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">p_total_transmission</span> <span class="o">=</span> <span class="n">p</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p_total_transmission</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">utils</span><span class="o">.</span><span class="n">binom_0</span><span class="p">(</span><span class="n">share_acts</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">p_total_transmission</span><span class="p">:</span>
            <span class="c1"># if agent HIV+ partner becomes HIV+</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hiv_convert</span><span class="p">(</span><span class="n">partner</span><span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="titan.model.HIVModel.make_agent_zero">
<code class="highlight language-python">
make_agent_zero<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
</h3>
<div class="doc doc-contents">
<p>Identify an agent as agent zero and HIV convert them</p>
<details class="quote">
<summary>Source code in <code>titan/model.py</code></summary>
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">make_agent_zero</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Identify an agent as agent zero and HIV convert them</span>
<span class="sd">    """</span>
    <span class="n">bonds</span> <span class="o">=</span> <span class="p">[</span>  <span class="c1"># Find what bond_types have the allowed interaction</span>
        <span class="n">bond</span>
        <span class="k">for</span> <span class="n">bond</span><span class="p">,</span> <span class="n">act_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">bond_types</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">agent_zero</span><span class="o">.</span><span class="n">interaction_type</span> <span class="ow">in</span> <span class="n">act_type</span><span class="o">.</span><span class="n">acts_allowed</span>
    <span class="p">]</span>
    <span class="n">max_partners</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">max_agent</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">zero_eligible</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">all_agents</span><span class="p">:</span>
        <span class="n">num_partners</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">get_num_partners</span><span class="p">(</span><span class="n">bond_types</span><span class="o">=</span><span class="n">bonds</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">num_partners</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">agent_zero</span><span class="o">.</span><span class="n">num_partners</span><span class="p">:</span>
            <span class="n">zero_eligible</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">num_partners</span> <span class="o">&gt;</span> <span class="n">max_partners</span><span class="p">:</span>
            <span class="n">max_partners</span> <span class="o">=</span> <span class="n">num_partners</span>
            <span class="n">max_agent</span> <span class="o">=</span> <span class="n">agent</span>

    <span class="n">agent_zero</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">safe_random_choice</span><span class="p">(</span><span class="n">zero_eligible</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">agent_zero</span><span class="p">:</span>  <span class="c1"># if eligible agent, make agent 0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hiv_convert</span><span class="p">(</span><span class="n">agent_zero</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">agent_zero</span><span class="o">.</span><span class="n">fallback</span> <span class="ow">and</span> <span class="n">max_agent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hiv_convert</span><span class="p">(</span><span class="n">max_agent</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"No agent zero!"</span><span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="titan.model.HIVModel.pca_interaction">
<code class="highlight language-python">
pca_interaction<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rel</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> </code>
</h3>
<div class="doc doc-contents">
<p>Simulate peer change agent interactions. Knowledge if one agent is aware and one unaware,
    opinion if one agent swaying the other.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>rel</code></td>
<td><code>Relationship</code></td>
<td>
<p>The relationship PCA is happening in</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>force</code></td>
<td><code></code></td>
<td>
<p>Whether to force knowledge dissemination and influence</p>
</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>titan/model.py</code></summary>
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">pca_interaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rel</span><span class="p">:</span> <span class="n">Relationship</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Simulate peer change agent interactions. Knowledge if one agent is aware and one unaware,</span>
<span class="sd">        opinion if one agent swaying the other.</span>

<span class="sd">    args:</span>
<span class="sd">        rel: The relationship PCA is happening in</span>
<span class="sd">        force: Whether to force knowledge dissemination and influence</span>
<span class="sd">    """</span>

    <span class="k">assert</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">enable</span>
    <span class="p">),</span> <span class="s2">"Network must be enabled for pca interactions"</span>

    <span class="k">def</span> <span class="nf">influence</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="n">partner</span><span class="p">):</span>
        <span class="n">agent_init_opinion</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">prep_opinion</span>
        <span class="n">partner_init_opinion</span> <span class="o">=</span> <span class="n">partner</span><span class="o">.</span><span class="n">prep_opinion</span>
        <span class="n">agent_influence</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">closeness_centrality</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">graph</span><span class="p">,</span> <span class="n">agent</span><span class="p">)</span>
        <span class="n">partner_influence</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">closeness_centrality</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">graph</span><span class="p">,</span> <span class="n">partner</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">agent_influence</span> <span class="o">&gt;</span> <span class="n">partner_influence</span><span class="p">:</span>
            <span class="n">partner</span><span class="o">.</span><span class="n">prep_opinion</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
                <span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">prep_opinion</span><span class="p">,</span> <span class="n">partner</span><span class="o">.</span><span class="n">prep_opinion</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">agent_influence</span> <span class="o">&lt;</span> <span class="n">partner_influence</span><span class="p">:</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">prep_opinion</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">agent</span><span class="o">.</span><span class="n">prep_opinion</span><span class="p">,</span> <span class="n">partner</span><span class="o">.</span><span class="n">prep_opinion</span><span class="p">])</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="n">agent_init_opinion</span>
            <span class="o">&lt;</span> <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">pca</span><span class="o">.</span><span class="n">opinion</span><span class="o">.</span><span class="n">threshold</span>
            <span class="o">&lt;</span> <span class="n">agent</span><span class="o">.</span><span class="n">prep_opinion</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">pca</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">prob</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">initiate_prep</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">elif</span> <span class="p">(</span>
            <span class="n">partner_init_opinion</span>
            <span class="o">&lt;</span> <span class="n">partner</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">pca</span><span class="o">.</span><span class="n">opinion</span><span class="o">.</span><span class="n">threshold</span>
            <span class="o">&lt;</span> <span class="n">partner</span><span class="o">.</span><span class="n">prep_opinion</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
                <span class="o">&lt;</span> <span class="n">partner</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">pca</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">prob</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">initiate_prep</span><span class="p">(</span><span class="n">partner</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">knowledge_dissemination</span><span class="p">(</span><span class="n">partner</span><span class="p">):</span>
        <span class="n">partner</span><span class="o">.</span><span class="n">prep_awareness</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">partner</span><span class="o">.</span><span class="n">prep_opinion</span>
            <span class="o">&gt;</span> <span class="n">partner</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">pca</span><span class="o">.</span><span class="n">opinion</span><span class="o">.</span><span class="n">threshold</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
            <span class="o">&lt;</span> <span class="n">partner</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">pca</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">prob</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initiate_prep</span><span class="p">(</span><span class="n">partner</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">knowledge_transmission_probability</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">rel</span><span class="o">.</span><span class="n">agent1</span><span class="o">.</span><span class="n">prep_awareness</span> <span class="ow">and</span> <span class="n">rel</span><span class="o">.</span><span class="n">agent2</span><span class="o">.</span><span class="n">prep_awareness</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">pca</span><span class="o">.</span><span class="n">opinion</span><span class="o">.</span><span class="n">transmission</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">pca</span><span class="o">.</span><span class="n">knowledge</span><span class="o">.</span><span class="n">transmission</span>

        <span class="k">if</span> <span class="n">num_acts</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">p_total_transmission</span> <span class="o">=</span> <span class="n">p</span>
        <span class="k">elif</span> <span class="n">num_acts</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">p_total_transmission</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">utils</span><span class="o">.</span><span class="n">binom_0</span><span class="p">(</span><span class="n">num_acts</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p_total_transmission</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="n">p_total_transmission</span>

    <span class="n">acts_prob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
    <span class="n">acts_bin</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">current_p_value</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">while</span> <span class="n">acts_prob</span> <span class="o">&gt;</span> <span class="n">current_p_value</span><span class="p">:</span>
        <span class="n">acts_bin</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">current_p_value</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">partnership</span><span class="o">.</span><span class="n">pca</span><span class="o">.</span><span class="n">frequency</span><span class="p">[</span><span class="n">rel</span><span class="o">.</span><span class="n">bond_type</span><span class="p">][</span>
            <span class="n">acts_bin</span>
        <span class="p">]</span><span class="o">.</span><span class="n">prob</span>
    <span class="nb">min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">partnership</span><span class="o">.</span><span class="n">pca</span><span class="o">.</span><span class="n">frequency</span><span class="p">[</span><span class="n">rel</span><span class="o">.</span><span class="n">bond_type</span><span class="p">][</span><span class="n">acts_bin</span><span class="p">]</span><span class="o">.</span><span class="n">min</span>
    <span class="nb">max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">partnership</span><span class="o">.</span><span class="n">pca</span><span class="o">.</span><span class="n">frequency</span><span class="p">[</span><span class="n">rel</span><span class="o">.</span><span class="n">bond_type</span><span class="p">][</span><span class="n">acts_bin</span><span class="p">]</span><span class="o">.</span><span class="n">max</span>
    <span class="k">if</span> <span class="nb">min</span> <span class="o">==</span> <span class="nb">max</span><span class="p">:</span>
        <span class="n">num_acts</span> <span class="o">=</span> <span class="nb">min</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">num_acts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">num_acts</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">force</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">rel</span><span class="o">.</span><span class="n">agent1</span><span class="o">.</span><span class="n">prep_awareness</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">rel</span><span class="o">.</span><span class="n">agent2</span><span class="o">.</span><span class="n">prep_awareness</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">knowledge_transmission_probability</span><span class="p">()</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
            <span class="n">knowledge_dissemination</span><span class="p">(</span><span class="n">rel</span><span class="o">.</span><span class="n">agent2</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">rel</span><span class="o">.</span><span class="n">agent1</span><span class="o">.</span><span class="n">prep_awareness</span> <span class="ow">and</span> <span class="n">rel</span><span class="o">.</span><span class="n">agent2</span><span class="o">.</span><span class="n">prep_awareness</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">knowledge_transmission_probability</span><span class="p">()</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
            <span class="n">knowledge_dissemination</span><span class="p">(</span><span class="n">rel</span><span class="o">.</span><span class="n">agent1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">rel</span><span class="o">.</span><span class="n">agent1</span><span class="o">.</span><span class="n">prep_awareness</span> <span class="ow">and</span> <span class="n">rel</span><span class="o">.</span><span class="n">agent2</span><span class="o">.</span><span class="n">prep_awareness</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">knowledge_transmission_probability</span><span class="p">()</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
            <span class="n">influence</span><span class="p">(</span><span class="n">rel</span><span class="o">.</span><span class="n">agent1</span><span class="p">,</span> <span class="n">rel</span><span class="o">.</span><span class="n">agent2</span><span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="titan.model.HIVModel.print_stats">
<code class="highlight language-python">
print_stats<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stat</span><span class="p">,</span> <span class="n">outdir</span><span class="p">)</span> </code>
</h3>
<div class="doc doc-contents">
<p>Create/update all of the reports defined in the params</p>
<details class="quote">
<summary>Source code in <code>titan/model.py</code></summary>
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">print_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stat</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="n">outdir</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Create/update all of the reports defined in the params</span>
<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">report</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">reports</span><span class="p">:</span>
        <span class="n">printer</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ao</span><span class="p">,</span> <span class="n">report</span><span class="p">)</span>
        <span class="n">printer</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_seed</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">pop_seed</span><span class="p">,</span>
            <span class="n">stat</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span>
            <span class="n">outdir</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># network-based reports</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">print_frequency</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">enable</span>
    <span class="p">):</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">network_utils</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">),</span> <span class="s2">"Graph must be enabled to print network reports"</span>

        <span class="n">network_outdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="s2">"network"</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">draw_figures</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">network_utils</span><span class="o">.</span><span class="n">visualize_network</span><span class="p">(</span>
                <span class="n">network_outdir</span><span class="p">,</span> <span class="n">curtime</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">"</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">calc_component_stats</span><span class="p">:</span>
            <span class="n">ao</span><span class="o">.</span><span class="n">print_components</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">run_seed</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">pop_seed</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">connected_components</span><span class="p">(),</span>
                <span class="n">network_outdir</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">races</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">calc_network_stats</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">network_utils</span><span class="o">.</span><span class="n">write_network_stats</span><span class="p">(</span>
                <span class="n">network_outdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">edge_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">network_utils</span><span class="o">.</span><span class="n">write_graph_edgelist</span><span class="p">(</span>
                <span class="n">network_outdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span>
            <span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="titan.model.HIVModel.progress_to_aids">
<code class="highlight language-python">
progress_to_aids<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">)</span> </code>
</h3>
<div class="doc doc-contents">
<p>Model the progression of HIV agents to AIDS agents</p>
<details class="quote">
<summary>Source code in <code>titan/model.py</code></summary>
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">progress_to_aids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span> <span class="n">Agent</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Model the progression of HIV agents to AIDS agents</span>
<span class="sd">    """</span>
    <span class="c1"># only valid for HIV agents</span>
    <span class="k">assert</span> <span class="n">agent</span><span class="o">.</span><span class="n">hiv</span>

    <span class="n">p</span> <span class="o">=</span> <span class="n">prob</span><span class="o">.</span><span class="n">adherence_prob</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">haart_adherence</span><span class="p">)</span> <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">haart</span> <span class="k">else</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">p</span> <span class="o">*</span> <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">hiv</span><span class="o">.</span><span class="n">aids</span><span class="o">.</span><span class="n">prob</span><span class="p">:</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">aids</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="titan.model.HIVModel.run">
<code class="highlight language-python">
run<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outdir</span><span class="p">)</span> </code>
</h3>
<div class="doc doc-contents">
<p>Runs the model for the number of time steps defined in params, at each time step does:</p>
<ol>
<li>Increments time</li>
<li>Takes one step</li>
<li>Resets trackers</li>
</ol>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>outdir</code></td>
<td><code>str</code></td>
<td>
<p>path to directory where results should be saved</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>titan/model.py</code></summary>
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outdir</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Runs the model for the number of time steps defined in params, at each time step does:</span>

<span class="sd">    1. Increments time</span>
<span class="sd">    2. Takes one step</span>
<span class="sd">    3. Resets trackers</span>

<span class="sd">    args:</span>
<span class="sd">        outdir: path to directory where results should be saved</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">burn_steps</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\t</span><span class="s2">===! Start Burn Loop !==="</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># make sure t0 things get printed</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="n">ao</span><span class="o">.</span><span class="n">get_stats</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">all_agents</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">new_prep</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">new_infections</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">new_dx</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">new_high_risk</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">new_incar_release</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">deaths</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_stats</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="n">outdir</span><span class="p">)</span>
    <span class="c1"># burn is negative time, model run starts at t = 1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
        <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">burn_steps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">num_steps</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">outdir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_trackers</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">burn_steps</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\t</span><span class="s2">===! Burn Loop Complete !==="</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\t</span><span class="s2">===! Start Main Loop !==="</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\t</span><span class="s2">===! Main Loop Complete !==="</span><span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="titan.model.HIVModel.sex_transmission">
<code class="highlight language-python">
sex_transmission<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rel</span><span class="p">)</span> </code>
</h3>
<div class="doc doc-contents">
<p>Simulate random transmission of HIV between two agents through Sex. One of the agents must have HIV.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>rel</code></td>
<td><code>Relationship</code></td>
<td>
<p>Relationship</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>titan/model.py</code></summary>
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">sex_transmission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rel</span><span class="p">:</span> <span class="n">Relationship</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Simulate random transmission of HIV between two agents through Sex. One of the agents must have HIV.</span>

<span class="sd">    args:</span>
<span class="sd">        rel : Relationship</span>
<span class="sd">    """</span>

    <span class="k">if</span> <span class="n">rel</span><span class="o">.</span><span class="n">agent1</span><span class="o">.</span><span class="n">hiv</span><span class="p">:</span>
        <span class="n">agent</span> <span class="o">=</span> <span class="n">rel</span><span class="o">.</span><span class="n">agent1</span>
        <span class="n">partner</span> <span class="o">=</span> <span class="n">rel</span><span class="o">.</span><span class="n">agent2</span>
    <span class="k">elif</span> <span class="n">rel</span><span class="o">.</span><span class="n">agent2</span><span class="o">.</span><span class="n">hiv</span><span class="p">:</span>
        <span class="n">agent</span> <span class="o">=</span> <span class="n">rel</span><span class="o">.</span><span class="n">agent2</span>
        <span class="n">partner</span> <span class="o">=</span> <span class="n">rel</span><span class="o">.</span><span class="n">agent1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"rel must have an agent with HIV"</span><span class="p">)</span>

    <span class="c1"># HIV status of agent and partner</span>
    <span class="c1"># Everything from here is only run if one of them is HIV+</span>
    <span class="k">if</span> <span class="n">partner</span><span class="o">.</span><span class="n">hiv</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="c1"># unprotected sex probabilities for primary partnerships</span>
    <span class="n">mean_sex_acts</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">get_number_of_sex_acts</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">np_random</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibration</span><span class="o">.</span><span class="n">sex</span><span class="o">.</span><span class="n">act</span>
    <span class="p">)</span>
    <span class="n">total_sex_acts</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">mean_sex_acts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">np_random</span><span class="p">)</span>

    <span class="c1"># Get condom usage</span>
    <span class="n">p_safe_sex</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">demographics</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">race</span><span class="p">][</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">sex_type</span>
    <span class="p">]</span><span class="o">.</span><span class="n">safe_sex</span>
    <span class="c1"># increase condom usage if diagnosed</span>
    <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">hiv_dx</span> <span class="ow">or</span> <span class="n">partner</span><span class="o">.</span><span class="n">hiv_dx</span><span class="p">:</span>
        <span class="c1"># Calculate probability of safe sex given risk reduction</span>
        <span class="n">p_unsafe_sex</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p_safe_sex</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
            <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">hiv</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">risk_reduction</span><span class="o">.</span><span class="n">sex</span>
        <span class="p">)</span>
        <span class="n">p_safe_sex</span> <span class="o">*=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">p_unsafe_sex</span>

    <span class="c1"># Reduction of risk acts between partners for condom usage</span>
    <span class="n">unsafe_sex_acts</span> <span class="o">=</span> <span class="n">total_sex_acts</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">unsafe_sex_acts</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">p_safe_sex</span><span class="p">:</span>
            <span class="n">unsafe_sex_acts</span> <span class="o">-=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">unsafe_sex_acts</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># agent is HIV+</span>
        <span class="n">rel</span><span class="o">.</span><span class="n">total_sex_acts</span> <span class="o">+=</span> <span class="n">unsafe_sex_acts</span>
        <span class="n">p_per_act</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_transmission_probability</span><span class="p">(</span><span class="s2">"sex"</span><span class="p">,</span> <span class="n">agent</span><span class="p">,</span> <span class="n">partner</span><span class="p">)</span>

        <span class="n">p_total_transmission</span><span class="p">:</span> <span class="nb">float</span>
        <span class="k">if</span> <span class="n">unsafe_sex_acts</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">p_total_transmission</span> <span class="o">=</span> <span class="n">p_per_act</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p_total_transmission</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">utils</span><span class="o">.</span><span class="n">binom_0</span><span class="p">(</span><span class="n">unsafe_sex_acts</span><span class="p">,</span> <span class="n">p_per_act</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">p_total_transmission</span><span class="p">:</span>
            <span class="c1"># if agent HIV+ partner becomes HIV+</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hiv_convert</span><span class="p">(</span><span class="n">partner</span><span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="titan.model.HIVModel.step">
<code class="highlight language-python">
step<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outdir</span><span class="p">)</span> </code>
</h3>
<div class="doc doc-contents">
<p>A single time step in the model:</p>
<ol>
<li>Perform timeline_scaling updates to params if needed</li>
<li>Update all agents</li>
<li>Write/update reports with this timestep's data</li>
</ol>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>outdir</code></td>
<td><code>str</code></td>
<td>
<p>path to directory where reports should be saved</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>titan/model.py</code></summary>
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outdir</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    A single time step in the model:</span>

<span class="sd">    1. Perform timeline_scaling updates to params if needed</span>
<span class="sd">    2. Update all agents</span>
<span class="sd">    3. Write/update reports with this timestep's data</span>

<span class="sd">    args:</span>
<span class="sd">        outdir: path to directory where reports should be saved</span>
<span class="sd">    """</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span><span class="s2">.: TIME </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">"</span><span class="se">\t</span><span class="s2">STARTING HIV count:</span><span class="si">{}</span><span class="se">\t</span><span class="s2">Total Incarcerated:</span><span class="si">{}</span><span class="se">\t</span><span class="s2">HR+:</span><span class="si">{}</span><span class="se">\t</span><span class="s2">"</span>
        <span class="s2">"PrEP:</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">hiv_agents</span><span class="o">.</span><span class="n">num_members</span><span class="p">(),</span>
            <span class="nb">sum</span><span class="p">([</span><span class="mi">1</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">all_agents</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">incar</span><span class="p">]),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">high_risk_agents</span><span class="o">.</span><span class="n">num_members</span><span class="p">(),</span>
            <span class="nb">sum</span><span class="p">([</span><span class="mi">1</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">all_agents</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">prep</span><span class="p">]),</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">timeline_scaling</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">update_all_agents</span><span class="p">()</span>

    <span class="n">stats</span> <span class="o">=</span> <span class="n">ao</span><span class="o">.</span><span class="n">get_stats</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">all_agents</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_prep</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_infections</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_dx</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_high_risk</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_incar_release</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deaths</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">print_stats</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="n">outdir</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">((</span><span class="s2">"Number of relationships: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">relationships</span><span class="p">))))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">all_agents</span><span class="o">.</span><span class="n">print_subsets</span><span class="p">()</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="titan.model.HIVModel.timeline_scaling">
<code class="highlight language-python">
timeline_scaling<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
</h3>
<div class="doc doc-contents">
<p>Scale/un-scale any params with timeline_scaling definitions per their
definition.  Applied to all parameters (main model, and location specific).</p>
<details class="quote">
<summary>Source code in <code>titan/model.py</code></summary>
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">timeline_scaling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Scale/un-scale any params with timeline_scaling definitions per their</span>
<span class="sd">    definition.  Applied to all parameters (main model, and location specific).</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">timeline_scaling</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># gather all of the param objectss to be scaled</span>
    <span class="n">params_set</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">location</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">geography</span><span class="o">.</span><span class="n">locations</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="n">params_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>

    <span class="c1"># iterate over each param and update the values if the time is right</span>
    <span class="k">for</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">params_set</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">defn</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">timeline_scaling</span><span class="o">.</span><span class="n">timeline</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">param</span> <span class="o">=</span> <span class="n">defn</span><span class="o">.</span><span class="n">parameter</span>
            <span class="k">if</span> <span class="n">param</span> <span class="o">!=</span> <span class="s2">"ts_default"</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">defn</span><span class="o">.</span><span class="n">start_time</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"timeline scaling - </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
                    <span class="n">utils</span><span class="o">.</span><span class="n">scale_param</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">defn</span><span class="o">.</span><span class="n">scalar</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">defn</span><span class="o">.</span><span class="n">stop_time</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"timeline un-scaling - </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
                    <span class="n">utils</span><span class="o">.</span><span class="n">scale_param</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">defn</span><span class="o">.</span><span class="n">scalar</span><span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="titan.model.HIVModel.update_all_agents">
<code class="highlight language-python">
update_all_agents<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
</h3>
<div class="doc doc-contents">
<p>The core of the model.  For a time step, update all of the agents and relationships:</p>
<ol>
<li>Create an agent zero (if enabled and the time is right)</li>
<li>Update partner assignments (create new relationships as needed)</li>
<li>Agents in relationships interact</li>
<li>Update syringe services (if enabled)</li>
<li>Update each agent's status for:<ul>
<li>age</li>
<li>high risk</li>
<li>prep</li>
<li>incarceration</li>
<li>hiv</li>
</ul>
</li>
<li>End relationships with no remaining duration</li>
<li>Agent death/replacement</li>
</ol>
<details class="quote">
<summary>Source code in <code>titan/model.py</code></summary>
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">update_all_agents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    The core of the model.  For a time step, update all of the agents and relationships:</span>

<span class="sd">    1. Create an agent zero (if enabled and the time is right)</span>
<span class="sd">    2. Update partner assignments (create new relationships as needed)</span>
<span class="sd">    3. Agents in relationships interact</span>
<span class="sd">    4. Update syringe services (if enabled)</span>
<span class="sd">    5. Update each agent's status for:</span>
<span class="sd">        * age</span>
<span class="sd">        * high risk</span>
<span class="sd">        * prep</span>
<span class="sd">        * incarceration</span>
<span class="sd">        * hiv</span>
<span class="sd">    6. End relationships with no remaining duration</span>
<span class="sd">    7. Agent death/replacement</span>
<span class="sd">    """</span>
    <span class="c1"># If agent zero enabled, create agent zero at the beginning of main loop.</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">agent_zero</span><span class="o">.</span><span class="n">start_time</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">agent_zero</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_agent_zero</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">static_network</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">update_partner_assignments</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">enable_graph</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">trim_graph</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">relationships</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">agents_interact</span><span class="p">(</span><span class="n">rel</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">syringe_services</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_syringe_services</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">all_agents</span><span class="p">:</span>
        <span class="c1"># happy birthday agents!</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">steps_per_year</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="p">):</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">age</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">high_risk</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_high_risk</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">pca</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">pca</span><span class="o">.</span><span class="n">start_time</span>
            <span class="ow">and</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
                <span class="o">&lt;</span> <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">pca</span><span class="o">.</span><span class="n">awareness</span><span class="o">.</span><span class="n">prob</span>
            <span class="p">)</span>
        <span class="p">):</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">prep_awareness</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">pca</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">prob</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">initiate_prep</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">incar</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">incarcerate</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">msmw</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">msmw</span><span class="o">.</span><span class="n">hiv</span><span class="o">.</span><span class="n">prob</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hiv_convert</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">hiv</span><span class="p">:</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">hiv_time</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># If HIV hasn't started, ignore</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">hiv</span><span class="o">.</span><span class="n">start_time</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">diagnose_hiv</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">progress_to_aids</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">haart</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">update_haart</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">prep</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&gt;=</span> <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">start_time</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">prep</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">discontinue_prep</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">agent</span><span class="o">.</span><span class="n">prep_eligible</span><span class="p">():</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">initiate_prep</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">vaccine</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">agent</span><span class="o">.</span><span class="n">prep</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">advance_vaccine</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">prep</span>
        <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">==</span> <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">start_time</span>
        <span class="ow">and</span> <span class="s2">"RandomTrial"</span> <span class="ow">in</span> <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">prep</span><span class="o">.</span><span class="n">target_model</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_random_trial</span><span class="p">()</span>

    <span class="c1"># If static network, ignore relationship progression</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">static_network</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">relationships</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">rel</span><span class="o">.</span><span class="n">progress</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">remove_relationship</span><span class="p">(</span><span class="n">rel</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">die_and_replace</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">die_and_replace</span><span class="p">()</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="titan.model.HIVModel.update_haart">
<code class="highlight language-python">
update_haart<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">)</span> </code>
</h3>
<div class="doc doc-contents">
<p>Account for HIV treatment through highly active antiretroviral therapy
    (HAART).
    HAART was implemented in 1996, hence, there is treatment only after 1996.
    HIV treatment assumes that the agent knows their HIV+ status (<code>dx</code> is True).</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>agent</code></td>
<td><code>Agent</code></td>
<td>
<p>agent being updated</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>titan/model.py</code></summary>
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">update_haart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span> <span class="n">Agent</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Account for HIV treatment through highly active antiretroviral therapy</span>
<span class="sd">        (HAART).</span>
<span class="sd">        HAART was implemented in 1996, hence, there is treatment only after 1996.</span>
<span class="sd">        HIV treatment assumes that the agent knows their HIV+ status (`dx` is True).</span>

<span class="sd">    args:</span>
<span class="sd">        agent: agent being updated</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">haart</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">initiate</span><span class="p">(</span><span class="n">agent</span><span class="p">):</span>
        <span class="n">haart_adh</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">demographics</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">race</span><span class="p">][</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">sex_type</span>
        <span class="p">]</span><span class="o">.</span><span class="n">haart</span><span class="o">.</span><span class="n">adherence</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">haart_adh</span><span class="p">:</span>
            <span class="n">adherence</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">adherence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

        <span class="c1"># Add agent to HAART class set, update agent params</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">haart</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">haart_adherence</span> <span class="o">=</span> <span class="n">adherence</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">haart_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">haart_counts</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">race</span><span class="p">][</span><span class="n">agent</span><span class="o">.</span><span class="n">sex_type</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># Check valid input</span>
    <span class="k">assert</span> <span class="n">agent</span><span class="o">.</span><span class="n">hiv</span>

    <span class="c1"># Determine probability of HIV treatment</span>
    <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">hiv_dx</span><span class="p">:</span>
        <span class="n">haart_params</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">demographics</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">race</span><span class="p">][</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">sex_type</span>
        <span class="p">]</span><span class="o">.</span><span class="n">haart</span>
        <span class="c1"># Go on HAART</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">agent</span><span class="o">.</span><span class="n">haart</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">hiv</span><span class="o">.</span><span class="n">haart_cap</span><span class="p">:</span>
                <span class="c1"># if HAART is based on cap instead of prob, determine number of</span>
                <span class="c1"># HAART agents based on % of diagnosed agents</span>
                <span class="n">num_dx_agents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">dx_counts</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">race</span><span class="p">][</span><span class="n">agent</span><span class="o">.</span><span class="n">sex_type</span><span class="p">]</span>
                <span class="n">num_haart_agents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">haart_counts</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">race</span><span class="p">][</span><span class="n">agent</span><span class="o">.</span><span class="n">sex_type</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">num_haart_agents</span> <span class="o">&lt;</span> <span class="p">(</span>
                    <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">demographics</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">race</span><span class="p">][</span>
                        <span class="n">agent</span><span class="o">.</span><span class="n">sex_type</span>
                    <span class="p">]</span><span class="o">.</span><span class="n">haart</span><span class="o">.</span><span class="n">prob</span>
                    <span class="o">*</span> <span class="n">num_dx_agents</span>
                <span class="p">):</span>
                    <span class="n">initiate</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="p">(</span>
                    <span class="n">haart_params</span><span class="o">.</span><span class="n">prob</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibration</span><span class="o">.</span><span class="n">haart</span><span class="o">.</span><span class="n">coverage</span>
                <span class="p">):</span>
                    <span class="n">initiate</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>
        <span class="c1"># Go off HAART</span>
        <span class="k">elif</span> <span class="n">agent</span><span class="o">.</span><span class="n">haart</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">haart_params</span><span class="o">.</span><span class="n">discontinue</span><span class="p">:</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">haart</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">haart_adherence</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">haart_time</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">haart_counts</span><span class="p">[</span><span class="n">agent</span><span class="o">.</span><span class="n">race</span><span class="p">][</span><span class="n">agent</span><span class="o">.</span><span class="n">sex_type</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="titan.model.HIVModel.update_high_risk">
<code class="highlight language-python">
update_high_risk<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">)</span> </code>
</h3>
<div class="doc doc-contents">
<p>Update high risk agents or remove them from high risk pool</p>
<details class="quote">
<summary>Source code in <code>titan/model.py</code></summary>
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">update_high_risk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span> <span class="n">Agent</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Update high risk agents or remove them from high risk pool</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">agent</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">high_risk_agents</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">high_risk_time</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">high_risk_time</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">high_risk_agents</span><span class="o">.</span><span class="n">remove_agent</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">high_risk</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">incar</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">high_risk</span><span class="o">.</span><span class="n">partnership_types</span><span class="p">:</span>
                <span class="n">agent</span><span class="o">.</span><span class="n">mean_num_partners</span><span class="p">[</span>
                    <span class="n">bond</span>
                <span class="p">]</span> <span class="o">-=</span> <span class="n">agent</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">high_risk</span><span class="o">.</span><span class="n">partner_scale</span>
                <span class="n">agent</span><span class="o">.</span><span class="n">mean_num_partners</span><span class="p">[</span><span class="n">bond</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                    <span class="mi">0</span><span class="p">,</span> <span class="n">agent</span><span class="o">.</span><span class="n">mean_num_partners</span><span class="p">[</span><span class="n">bond</span><span class="p">]</span>
                <span class="p">)</span>  <span class="c1"># make sure not negative</span>
                <span class="n">agent</span><span class="o">.</span><span class="n">target_partners</span><span class="p">[</span><span class="n">bond</span><span class="p">]</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span>
                    <span class="n">agent</span><span class="o">.</span><span class="n">mean_num_partners</span><span class="p">[</span><span class="n">bond</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">np_random</span>
                <span class="p">)</span>
                <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">partners</span><span class="p">[</span><span class="n">bond</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">agent</span><span class="o">.</span><span class="n">target_partners</span><span class="p">[</span><span class="n">bond</span><span class="p">]:</span>
                    <span class="n">rel</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">safe_random_choice</span><span class="p">(</span>
                        <span class="n">agent</span><span class="o">.</span><span class="n">relationships</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">rel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">rel</span><span class="o">.</span><span class="n">progress</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">remove_relationship</span><span class="p">(</span><span class="n">rel</span><span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="titan.model.HIVModel.update_syringe_services">
<code class="highlight language-python">
update_syringe_services<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
</h3>
<div class="doc doc-contents">
<p>Enroll PWID agents in syringe services</p>
<details class="quote">
<summary>Source code in <code>titan/model.py</code></summary>
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">update_syringe_services</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Enroll PWID agents in syringe services</span>
<span class="sd">    """</span>
    <span class="nb">print</span><span class="p">((</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">!!!!Engaging syringe services program"</span><span class="p">))</span>
    <span class="n">ssp_num_slots</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ssp_agents</span> <span class="o">=</span> <span class="p">{</span><span class="n">agent</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">pwid_agents</span><span class="o">.</span><span class="n">members</span> <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">ssp</span><span class="p">}</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">syringe_services</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">syringe_services</span><span class="o">.</span><span class="n">timeline</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">start_time</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&lt;</span> <span class="n">item</span><span class="o">.</span><span class="n">stop_time</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ssp_enrolled_risk</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">risk</span>

                <span class="n">ssp_num_slots</span> <span class="o">=</span> <span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">num_slots_stop</span> <span class="o">-</span> <span class="n">item</span><span class="o">.</span><span class="n">num_slots_start</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                    <span class="n">item</span><span class="o">.</span><span class="n">stop_time</span> <span class="o">-</span> <span class="n">item</span><span class="o">.</span><span class="n">start_time</span>
                <span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">-</span> <span class="n">item</span><span class="o">.</span><span class="n">start_time</span><span class="p">)</span> <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="n">num_slots_start</span>

                <span class="c1"># If cap indicates all or no agents, do not change</span>
                <span class="c1"># otherwise, find true number of slots through distribution</span>
                <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">ssp_num_slots</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">pwid_agents</span><span class="o">.</span><span class="n">num_members</span><span class="p">():</span>
                    <span class="n">ssp_num_slots</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span><span class="o">.</span><span class="n">betavariate</span><span class="p">(</span>
                            <span class="n">ssp_num_slots</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">pwid_agents</span><span class="o">.</span><span class="n">num_members</span><span class="p">()</span> <span class="o">-</span> <span class="n">ssp_num_slots</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">pwid_agents</span><span class="o">.</span><span class="n">num_members</span><span class="p">()</span>
                    <span class="p">)</span>
                <span class="k">break</span>

    <span class="n">target_set</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">safe_shuffle</span><span class="p">(</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">pwid_agents</span><span class="o">.</span><span class="n">members</span> <span class="o">-</span> <span class="n">ssp_agents</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_random</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="n">ssp_agents</span><span class="o">.</span><span class="n">copy</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ssp_agents</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">ssp_num_slots</span><span class="p">:</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">ssp</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">ssp_agents</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">target_set</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="n">target_set</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ssp_agents</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">ssp_num_slots</span><span class="p">:</span>
                <span class="n">agent</span><span class="o">.</span><span class="n">ssp</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">ssp_agents</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">"SSP has </span><span class="si">{</span><span class="n">ssp_num_slots</span><span class="si">}</span><span class="s2"> target slots with "</span>
        <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">ssp_agents</span><span class="p">)</span><span class="si">}</span><span class="s2"> slots filled"</span>
    <span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
</div>
</div>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav aria-label="Footer" class="md-footer-nav__inner md-grid">
<a class="md-footer-nav__link md-footer-nav__link--prev" href="../location/" rel="prev">
<div class="md-footer-nav__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</div>
<div class="md-footer-nav__title">
<div class="md-ellipsis">
<span class="md-footer-nav__direction">
                  Previous
                </span>
                Location
              </div>
</div>
</a>
<a class="md-footer-nav__link md-footer-nav__link--next" href="../network/" rel="next">
<div class="md-footer-nav__title">
<div class="md-ellipsis">
<span class="md-footer-nav__direction">
                  Next
                </span>
                NetworkGraphUtils
              </div>
</div>
<div class="md-footer-nav__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"></path></svg>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
          Material for MkDocs
        </a>
</div>
</div>
</div>
</footer>
</div>
<script src="../../assets/javascripts/vendor.6a3d08fc.min.js"></script>
<script src="../../assets/javascripts/bundle.71201edf.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
<script>
        app = initialize({
          base: "../..",
          features: ['instant', 'tabs'],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
</body>
</html>